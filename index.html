<!DOCTYPE html>
<html>
  <head>
    <title></title>
  </head>

  <body>

    <div id="say-cheese-container">
      <div id="action-buttons">
        <button class="btn btn-success" id="take-snapshot">snap!</button>
      </div>
    </div>
    <div id="say-cheese-snapshots"></div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
    <script src="say-cheese.js"></script>
    <script>

      function dataURItoBlob(dataURI) {
        var binary = atob(dataURI.split(',')[1]);
        var array = [];

        for (var i = 0; i < binary.length; i++) {
          array.push(binary.charCodeAt(i));
        }

        var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];

        return new Blob([new Uint8Array(array)], { type: mimeString });
      }

      $(function() {
        var sayCheese = new SayCheese('#say-cheese-container', {
          camResolution: {
            width: 1280,
            height: 720
          }
        });

        sayCheese.on('start', function () {
          $('#take-snapshot').on('click', function (e) {
            sayCheese.takeSnapshot();
          });
        });

        sayCheese.on('error', function (error) {
          console.log(error);
        });

        // sayCheese.on('snapshot', function (snapshot) {
        //   var img = document.createElement('img');

        //   $(img).on('load', function () {
        //     $('#say-cheese-snapshots').prepend(img);
        //   });

        //   img.src = snapshot.toDataURL('image/png');
        // });

        sayCheese.on('snapshot', function (snapshot) {
          var formData = new FormData();
          formData.append('filename', 'test.png');
          formData.append('snapshot', dataURItoBlob(snapshot.toDataURL('image/png')));

          $.ajax({
              url: 'ajax/',
              type: 'POST',
              contentType: false,
              processData: false,
              data: formData,
              success: function (data, status, xhr) {
                console.log(data)
              }
          });
        });

        sayCheese.start();
      });
    </script>
  </body>
</html>
